# Presenton Template 系统 - ASCII 思维导图

```
                                    🎨 PRESENTON TEMPLATE 系统
                                              │
                    ┌─────────────────────────┼─────────────────────────┐
                    │                         │                         │
                📁 模板结构                 ⚙️ 工作流程               🔧 技术实现
                    │                         │                         │
        ┌───────────┴───────────┐    ┌────────┴────────┐        ┌──────┴──────┐
        │                       │    │                 │        │             │
    🖥️ 前端模板            💾 后端模板   1️⃣ 模板选择      2️⃣ 结构获取    📋 Schema提取   🔄 动态加载
        │                       │    │                 │        │             │
    ├─ 位置:                   ├─ TemplateModel     ├─ UI界面        ├─ API调用   ├─ /schema页面  ├─ LayoutContext
    │  presentation-templates/  │  ├─ id: UUID      │  ├─LayoutSelection │  ├─get_layout  │  ├─动态加载组件 │  ├─状态管理
    ├─ 目录结构:               │  ├─ name          │  ├─GroupLayouts  │   _by_name    │  ├─提取Schema  │  ├─组件缓存
    │  ├─ general/             │  ├─ description   │  └─模板预览      │  ├─HTTP请求   │  └─HTML属性    │  └─Babel编译
    │  │  ├─ settings.json     │  └─ created_at    │                 │  └─PresentationLayout │            │
    │  │  └─ *.tsx files       │                   │                 │    Model       │            │
    │  ├─ modern/              │                   3️⃣ 内容生成      4️⃣ 幻灯片渲染    │            │
    │  └─ classic/             │                   │                 │               │            │
    │                          │                   ├─ LLM调用        ├─ 动态组件加载     │            │
    └─ 组件文件:                │                   ├─ JSON Schema    ├─ 数据注入       │            │
       ├─ layoutId             │                   ├─ 内容验证       └─ 最终渲染       │            │
       ├─ layoutName           │                   └─ 数据库存储                      │            │
       ├─ layoutDescription    │                                                     │            │
       ├─ Zod Schema          │                                                     │            │
       └─ React Component     │                                                     │            │
```

## 🔄 详细工作流程

```
用户操作流程:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  1. 用户选择  │───▶│  2. 获取结构  │───▶│  3. 生成内容  │───▶│  4. 渲染展示  │
│     模板     │    │     Schema   │    │   LLM处理   │    │   组件渲染   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                    │                    │                    │
       ▼                    ▼                    ▼                    ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│LayoutSelection │  │get_layout_by │    │ LLM根据Schema │   │ 动态加载组件  │
│   组件显示     │  │  _name函数   │    │  生成幻灯片   │   │  数据注入    │
│   模板预览     │  │ Puppeteer   │    │    内容      │   │  最终渲染    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

后端处理链路:
┌────────────┐    ┌────────────┐    ┌────────────┐    ┌────────────┐
│ 接收请求    │───▶│ 获取模板    │───▶│ LLM生成    │───▶│ 存储数据    │
│ template   │    │ Schema     │    │ 内容       │    │ 返回结果    │
│ 参数       │    │ 结构       │    │ 验证格式    │    │ 展示路径    │
└────────────┘    └────────────┘    └────────────┘    └────────────┘
```

## 🏗️ 架构层次图

```
┌─────────────────────── 用户界面层 ──────────────────────┐
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ 模板选择页面  │  │ 大纲编辑页面  │  │ 幻灯片展示   │    │
│  │LayoutSelection│ │ OutlinePage │  │PresentationPage│   │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────┘
┌─────────────────────── API 层 ─────────────────────────┐
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │/api/templates│  │ /api/layout │  │/api/generate│    │
│  │ 获取模板列表  │  │ 获取Schema  │  │ 生成演示文稿  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────┘
┌─────────────────────── 服务层 ─────────────────────────┐
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │get_layout_by│  │ Puppeteer   │  │ LLM Service │    │
│  │   _name     │  │ 页面抓取    │  │ 内容生成     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────┘
┌─────────────────────── 数据层 ─────────────────────────┐
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │TemplateModel│  │SlideModel   │  │PresentationModel│ │
│  │ 模板元数据   │  │ 幻灯片数据   │  │  演示文稿     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────┘
```

## 📋 模板组件结构详解

```
📁 IntroSlideLayout.tsx 示例:
├── 📤 导出项目
│   ├── layoutId = 'general-intro-slide'        // 🆔 唯一标识
│   ├── layoutName = 'Intro Slide'              // 📝 显示名称
│   ├── layoutDescription = '介绍幻灯片...'       // 📋 组件描述
│   └── Schema = introSlideSchema               // 📊 数据结构
│
├── 🔍 Zod Schema 定义
│   ├── title: string (3-40字符)                // 📌 标题字段
│   ├── description: string (10-150字符)        // 📄 描述内容
│   ├── presenterName: string (2-50字符)        // 👤 演讲者姓名
│   ├── presentationDate: string               // 📅 演示日期
│   └── image: ImageSchema                     // 🖼️ 配图对象
│
└── ⚛️ React 组件
    ├── Props: { data?: Partial<IntroSlideData> } // 💾 数据接口
    ├── 布局结构:                                // 🎨 视觉设计
    │   ├── 左侧: 图片展示区域                   
    │   ├── 右侧: 内容展示区域                   
    │   │   ├── 主标题 (title)                  
    │   │   ├── 紫色分隔线                      
    │   │   ├── 描述文本 (description)          
    │   │   └── 演讲者信息卡片                  
    │   └── 响应式设计 (Tailwind CSS)           
    └── 样式特性:                               
        ├── Poppins 字体                        
        ├── 圆角设计                           
        ├── 阴影效果                           
        └── 渐变背景                           
```

## 🔄 Schema 提取机制

```
Schema 提取流程:
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  后端API请求   │───▶│  Puppeteer   │───▶│  前端Schema   │
│get_layout_by_│    │  启动浏览器   │    │     页面      │
│   name       │    │  访问URL     │    │ /schema?group │
└──────────────┘    └──────────────┘    └──────────────┘
        │                    │                    │
        ▼                    ▼                    ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  返回结构化   │◀───│  提取HTML属性 │◀───│ 动态加载组件  │
│ LayoutModel  │    │data-layouts  │    │ 提取Schema   │
│   JSON数据   │    │data-settings │    │ 设置属性     │
└──────────────┘    └──────────────┘    └──────────────┘

数据转换过程:
模板.tsx文件 ──┐
              ├─▶ 动态导入 ──┐
组件元数据 ──┘              ├─▶ JSON序列化 ──┐
                           │               ├─▶ HTML属性 ──┐
Zod Schema ────────────────┘               │              ├─▶ Puppeteer提取
                                          │              │
组件配置 ──────────────────────────────────┘              ▼
                                                    ┌──────────────┐
                                                    │PresentationLayout│
                                                    │     Model    │
                                                    │   ├─ name    │
                                                    │   ├─ ordered │
                                                    │   └─ slides[]│
                                                    └──────────────┘
```

## 🎯 关键理解要点

### 🔄 双向通信架构
```
前端 NextJS                   后端 FastAPI
     │                            │
     ├─ /api/templates ───────────▶ 返回模板列表
     │                            │
     ◀─ /api/layout?group=xxx ─────┤ Puppeteer请求
     │                            │
     ├─ /schema?group=xxx ────────▶ 提取Schema
     │                            │
     ◀─ PresentationLayoutModel ───┤ 结构化数据
```

### 💾 缓存优化策略
```
组件请求 ──┐
          ├─ 缓存检查 ──┐
          │            ├─ 命中 ──▶ 直接返回
          │            │
          │            └─ 未命中 ──┐
          │                      ├─ 动态加载
          │                      ├─ Babel编译  
          │                      ├─ 存入缓存
          │                      └─ 返回组件
          └─ 性能优化
```

### 🎨 模板分层设计
```
内容层 (Content)     ←─ LLM生成, JSON数据
   │
结构层 (Structure)   ←─ Zod Schema, 数据约束
   │  
展示层 (Presentation) ←─ React组件, 视觉布局
   │
样式层 (Style)       ←─ Tailwind CSS, 主题风格
```

这个ASCII版本的思维导图更加直观，你可以清楚地看到整个Template系统的层次结构和数据流向！